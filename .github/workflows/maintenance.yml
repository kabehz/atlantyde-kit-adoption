# ğŸ§  Este mantenimiento automatizado respeta la trazabilidad y Ã©tica del ecosistema ATLANTYDE.
# 
# Seguridad y RGPD: Este flujo no elimina datos automÃ¡ticamente, solo reporta y simula acciones.
name: ATLANTYDE Monthly Maintenance

on:
  schedule:
    - cron: '0 0 1 * *'  # Ejecutar a las 00:00 UTC del dÃ­a 1 de cada mes
  workflow_dispatch:

jobs:
  maintenance:
    runs-on: ubuntu-latest
    name: ğŸ§¹ Mantenimiento mensual del repositorio

    steps:
      - name: ğŸ“¥ Checkout del repositorio
        uses: actions/checkout@v4

      - name: ğŸ§  Identificar Ãºltima marca de desarrollo
        id: latest
        run: |
          LAST_TAG=$(git tag --sort=-creatordate | grep -E '^v[0-9]+\.[0-9]+\.[0-9]+(-dev[0-9]+)?$' | head -n 1)
          echo "Ãšltima marca detectada: $LAST_TAG"
          echo "tag=$LAST_TAG" >> $GITHUB_OUTPUT

      - name: ğŸ§¹ Limpieza de ramas temporales (simulado)
        run: |
          echo "Eliminando ramas locales temporales excepto main y dev..."
          git branch | grep -vE 'main|dev' | xargs -r echo "ğŸ—‘ï¸ Rama eliminada:"

      - name: ğŸ§½ Limpieza de marcas de versiones antiguas (simulado)
        run: |
          echo "Conservando solo la marca mÃ¡s reciente: ${{ steps.latest.outputs.tag }}"
          echo "Las siguientes marcas deberÃ­an ser evaluadas para limpieza manual si son obsoletas:"
          git tag --sort=-creatordate | grep -v "${{ steps.latest.outputs.tag }}" | head -n 10
          echo "âš ï¸ Nota: Las etiquetas no se eliminan automÃ¡ticamente por seguridad. RevisiÃ³n manual recomendada."

      - name: ğŸ§¾ Registro de mantenimiento
        run: echo "âœ… Mantenimiento mensual ejecutado correctamente"
#