# 🧠 Este mantenimiento automatizado respeta la trazabilidad y ética del ecosistema ATLANTYDE.
# 
# Seguridad y RGPD: Este flujo no elimina datos automáticamente, solo reporta y simula acciones.
name: ATLANTYDE Monthly Maintenance

on:
  schedule:
    - cron: '0 0 1 * *'  # Ejecutar a las 00:00 UTC del día 1 de cada mes
  workflow_dispatch:

jobs:
  maintenance:
    runs-on: ubuntu-latest
    name: 🧹 Mantenimiento mensual del repositorio

    steps:
      - name: 📥 Checkout del repositorio
        uses: actions/checkout@v4

      - name: 🧠 Identificar última marca de desarrollo
        id: latest
        run: |
          LAST_TAG=$(git tag --sort=-creatordate | grep -E '^v[0-9]+\.[0-9]+\.[0-9]+(-dev[0-9]+)?$' | head -n 1)
          echo "Última marca detectada: $LAST_TAG"
          echo "tag=$LAST_TAG" >> $GITHUB_OUTPUT

      - name: 🧹 Limpieza de ramas temporales (simulado)
        run: |
          echo "Eliminando ramas locales temporales excepto main y dev..."
          git branch | grep -vE 'main|dev' | xargs -r echo "🗑️ Rama eliminada:"

      - name: 🧽 Limpieza de marcas de versiones antiguas (simulado)
        run: |
          echo "Conservando solo la marca más reciente: ${{ steps.latest.outputs.tag }}"
          echo "Las siguientes marcas deberían ser evaluadas para limpieza manual si son obsoletas:"
          git tag --sort=-creatordate | grep -v "${{ steps.latest.outputs.tag }}" | head -n 10
          echo "⚠️ Nota: Las etiquetas no se eliminan automáticamente por seguridad. Revisión manual recomendada."

      - name: 🧾 Registro de mantenimiento
        run: echo "✅ Mantenimiento mensual ejecutado correctamente"
#